---
startTime: May 26, 2019 5:47 PM
endTime: Oct 31, 2019 9:16 PM
tag: Programming, Game
author: 배현직        
title: 게임 서버 프로그래밍 교과서 Chapter 7
---

## Ch 7. Database

### 단순 파일 vs 데이터베이스
|구분          |단순 파일                                                                                |데이터베이스                                                |비고                                                                            |
|------------|-------------------------------------------------------------------------------------|------------------------------------------------------|------------------------------------------------------------------------------|
|소프트웨어 비용    |없다                                                                                   |없거나 높음                                                |오픈 소스 제품(MySql, MongoDB, MariaDB)은 제한적으로 무료                                   |
|저장 및 로딩 속도  |빠름                                                                                   |느림                                                    |데이터베이스도 결국 파일 시스템을 사용                                                         |
|데이터 관리, 분석 속도|느림                                                                                   |빠름                                                    |데이터베이스는 빠른 검색을 위한 인덱스 기능 존재                                                   |
|데이터 백업, 복원 기능|없음                                                                                   |있음                                                    |                                                                              |
|원자성 (Atomicity)|불가능                                                                                  |가능 (transaction 기능)                                   |query가 모두 실행되든지 하나도 실행되지 않든지 둘 중 하나의 결과만 보장하게 함                               |
|일관성 (Consistency)|없음                                                                                   |있음 (constraint 기능)                                    |잘못된 상태의 데이터를 원천 봉쇄                                                            |
|고립성 (Isolation)|없음                                                                                   |있음 (lock 기능)                                          |race condition에서 자유로울 수 있게 하는 기능                                              |
|지속성 (Duration)|없음                                                                                   |있음 (로그 버퍼 기능)                                         |장애 직전 상태로 복수할 수 있는지에 관한 것                                                     |

- 게임 서버가 데이터베이스 질의 구문을 자주 던지는 것은 비효율적
    - 질의 구문 던지기 후 결과 받기 과정이 수행되는 동안 Device time 발생
    - 게임 서버와 데이터 베이스 간 네트워크 레이턴시를 다 모으면 꽤 긴 시간임

    → 따라서, Stored Procedure을 사용 : 미리 저장해논 질의 구문 집합

    → 게임 서버가 메모리에 정보를 가지고 있고, 주기적으로 데이터를 모아서 데이터베이스에 기록하는 것이 일반적

- Transaction 기능 사용 시 유의할 점
    - 트랜잭션을 걸고 액세스하는 레코드는 뮤텍스를 잠금한 것과 비슷
    - 트랜잭션을 걸고 액세스하는 레코드는 다른 질의 구문 세션에서 액세스하면 앞서 트랜잭션이 완료되거나 취소될 때까지 블로킹이 걸림
- ORM (Object-Relational Mapping) 객체 관계 매핑
    - 데이터베이스 우선 방법 ; 데이터벵시트 테이블이나 필드를 정의하면, 이 테이블을 편하게 액세스할 수 있는 데이터베이스 액세스 클래스들이 생성됨
    - 코드 우선 방법 : 데이터 베이스를 액세스할 클래스를 정의하고, 클래스 안에는 사용할 멤버 변수를 정의. 정의한 클래스 구조에 따라 데이터베이스가 생성되거나 변경됨